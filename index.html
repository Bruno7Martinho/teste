<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoChapas - Portal da Oficina</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* Reset e estilos gerais */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Header e Navegação */
        header {
            background-color: var(--primary);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h1 {
            font-size: 1.5rem;
        }

        .logo-icon {
            font-size: 1.8rem;
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li {
            margin-left: 1.5rem;
        }

        nav ul li a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        nav ul li a:hover, 
        nav ul li a.active {
            background-color: var(--secondary);
        }

        /* Conteúdo Principal */
        main {
            padding: 2rem 0;
            min-height: calc(100vh - 140px);
        }

        .page-title {
            margin-bottom: 1.5rem;
            color: var(--primary);
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 0.5rem;
        }

        /* Cards e Grids */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .card-header {
            background-color: var(--primary);
            color: white;
            padding: 1rem;
            font-weight: bold;
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Formulários */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .btn:hover {
            background-color: #2980b9;
        }

        .btn-success {
            background-color: var(--success);
        }

        .btn-success:hover {
            background-color: #27ae60;
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-warning {
            background-color: var(--warning);
        }

        .btn-warning:hover {
            background-color: #e67e22;
        }

        /* Tabelas */
        .table-responsive {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        table th, table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        table th {
            background-color: var(--primary);
            color: white;
        }

        table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        table tr:hover {
            background-color: #f1f1f1;
        }

        /* Status badges */
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-pending {
            background-color: var(--warning);
            color: white;
        }

        .status-in-progress {
            background-color: var(--secondary);
            color: white;
        }

        .status-completed {
            background-color: var(--success);
            color: white;
        }

        .status-approved {
            background-color: var(--success);
            color: white;
        }

        .status-rejected {
            background-color: var(--danger);
            color: white;
        }

        /* Páginas ocultas */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-3px);
        }

        .stat-card h3 {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-card p {
            color: #666;
        }

        .stat-card.lucro {
            border-left: 4px solid var(--success);
        }

        .stat-card.receita {
            border-left: 4px solid var(--secondary);
        }

        .stat-card.despesa {
            border-left: 4px solid var(--danger);
        }

        /* Footer */
        footer {
            background-color: var(--primary);
            color: white;
            text-align: center;
            padding: 1.5rem 0;
            margin-top: 2rem;
        }

        /* Estilos específicos para o formulário de orçamento */
        .orcamento-form {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .produto {
            border: 1px solid #ddd;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 4px;
            background-color: #f9f9f9;
        }

        .produto select, .produto input {
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .observacoes {
            margin-top: 1.5rem;
        }

        .observacoes textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #ddd;
            padding-bottom: 1rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        /* Animações para atualizações */
        @keyframes highlight {
            0% { background-color: #ffff99; }
            100% { background-color: transparent; }
        }

        .highlight {
            animation: highlight 2s ease-in-out;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }

            nav ul li {
                margin: 0.25rem;
            }

            .cards-grid {
                grid-template-columns: 1fr;
            }
            
            .produto select, .produto input {
                width: 100%;
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">
                <span class="logo-icon">🔧</span>
                <h1>AutoChapas</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="nav-link active" data-page="dashboard">Dashboard</a></li>
                    <li><a href="#" class="nav-link" data-page="orcamentos">Orçamentos</a></li>
                    <li><a href="#" class="nav-link" data-page="carros-oficina">Carros na Oficina</a></li>
                    <li><a href="#" class="nav-link" data-page="carros-entrada">Carros para Entrar</a></li>
                    <li><a href="#" class="nav-link" data-page="servicos-completos">Serviços Completos</a></li>
                    <li><a href="#" class="nav-link" data-page="financeiro">Financeiro</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <!-- Dashboard -->
        <section id="dashboard" class="page active">
            <h2 class="page-title">Dashboard</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="count-carros-oficina">0</h3>
                    <p>Carros na Oficina</p>
                </div>
                <div class="stat-card">
                    <h3 id="count-orcamentos-pendentes">0</h3>
                    <p>Orçamentos Pendentes</p>
                </div>
                <div class="stat-card">
                    <h3 id="count-carros-entrada">0</h3>
                    <p>Carros para Entrar</p>
                </div>
                <div class="stat-card lucro">
                    <h3 id="lucro-mes">R$ 0</h3>
                    <p>Lucro do Mês</p>
                </div>
            </div>

            <h3>Atividades Recentes</h3>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Carro</th>
                            <th>Serviço</th>
                            <th>Status</th>
                            <th>Data</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="atividades-recentes">
                        <!-- Será preenchido dinamicamente -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Orçamentos -->
        <section id="orcamentos" class="page">
            <h2 class="page-title">Criar Orçamentos</h2>
            
            <div class="orcamento-form">
                <h3>ALEXANDRE REPAROS AUTOMOTIVOS</h3>
                
                <div class="form-group">
                    <label for="cliente">Nome do Cliente:</label>
                    <input type="text" id="cliente" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="data">Data:</label>
                    <input type="date" id="data" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="placa">Placa do Carro:</label>
                    <input type="text" id="placa" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="modeloCarro">Modelo do Carro:</label>
                    <input type="text" id="modeloCarro" class="form-control">
                </div>

                <h3>Produtos:</h3>
                <div id="produtos">
                    <div class="produto">
                        <select class="descricao form-control">
                            <option value="">Selecione a peça ou serviço</option>
                            <optgroup label="Peças">
                                <option>Porta Dianteira Esquerda</option>
                                <option>Porta Dianteira Direita</option>
                                <option>Porta Traseira Esquerda</option>
                                <option>Porta Traseira Direita</option>
                                <option>Parachoque Dianteiro</option>
                                <option>Parachoque Traseiro</option>
                                <option>Capô</option>
                                <option>Farol Esquerdo</option>
                                <option>Farol Direito</option>
                                <option>Lanterna Esquerda</option>
                                <option>Lanterna Direita</option>
                                <option>Alma Dianteira</option>
                                <option>Painel Frontal</option>
                            </optgroup>
                            <optgroup label="Serviços de Mão de Obra">
                                <option>Mão de Obra - Funilaria</option>
                                <option>Mão de Obra - Pintura</option>
                                <option>Mão de Obra - Polimento</option>
                                <option>Mão de Obra - Desmontagem</option>
                                <option>Mão de Obra - Montagem</option>
                                <option>Mão de Obra - Alinhamento de Chassi</option>
                                <option>Mão de Obra - Substituição de Parachoque</option>
                                <option>Mão de Obra - Solda</option>
                                <option>Mão de Obra - Revisão</option>
                                <option>Mão de Obra - Lavagem Completa</option>
                            </optgroup>
                            <option value="outro">Outro serviço (digite manualmente)</option>
                        </select>
                        <input type="text" class="descricao-manual form-control" placeholder="Descreva o serviço" style="display:none; margin-top: 5px;" />
                        <input placeholder="Quantidade" type="number" class="quantidade form-control" />
                        <input placeholder="Valor Unitário" type="number" class="valor form-control" />
                        <button class="btn btn-danger" onclick="removerProduto(this)">Remover</button>
                    </div>
                </div>

                <button class="btn" onclick="adicionarProduto()">Adicionar Produto</button>
                
                <div class="observacoes">
                    <label for="observacoes">Observações:</label>
                    <textarea id="observacoes" rows="4" placeholder="Digite observações aqui..."></textarea>
                </div>
                
                <button class="btn btn-success" onclick="gerarPDF()">Gerar PDF</button>
                <button class="btn" onclick="salvarOrcamento()">Salvar Orçamento</button>
            </div>

            <h3>Orçamentos Pendentes</h3>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Veículo</th>
                            <th>Placa</th>
                            <th>Valor</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="orcamentos-pendentes">
                        <!-- Será preenchido dinamicamente -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Carros na Oficina -->
        <section id="carros-oficina" class="page">
            <h2 class="page-title">Carros na Oficina</h2>
            <div class="cards-grid" id="carros-oficina-grid">
                <!-- Será preenchido dinamicamente -->
            </div>
        </section>

        <!-- Carros para Entrar -->
        <section id="carros-entrada" class="page">
            <h2 class="page-title">Carros para Entrar</h2>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Veículo</th>
                            <th>Placa</th>
                            <th>Serviço</th>
                            <th>Data Agendada</th>
                            <th>Valor Estimado</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="carros-entrada-lista">
                        <!-- Será preenchido dinamicamente -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Serviços Completos -->
        <section id="servicos-completos" class="page">
            <h2 class="page-title">Serviços Completos</h2>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Cliente</th>
                            <th>Veículo</th>
                            <th>Placa</th>
                            <th>Serviço</th>
                            <th>Valor (R$)</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="servicos-completos-lista">
                        <!-- Será preenchido dinamicamente -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Financeiro -->
        <section id="financeiro" class="page">
            <h2 class="page-title">Financeiro</h2>
            
            <div class="stats-grid">
                <div class="stat-card lucro">
                    <h3 id="lucro-mes-financeiro">R$ 0</h3>
                    <p>Lucro do Mês</p>
                </div>
                <div class="stat-card receita">
                    <h3 id="receita-mes">R$ 0</h3>
                    <p>Receita do Mês</p>
                </div>
                <div class="stat-card despesa">
                    <h3 id="despesas-mes">R$ 0</h3>
                    <p>Despesas do Mês</p>
                </div>
                <div class="stat-card receita">
                    <h3 id="receita-anual">R$ 0</h3>
                    <p>Receita Anual</p>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem;">
                <div>
                    <h3>Despesas por Categoria</h3>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Categoria</th>
                                    <th>Valor (R$)</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="despesas-categoria">
                                <!-- Será preenchido dinamicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div>
                    <h3>Adicionar Despesa</h3>
                    <div class="card">
                        <div class="card-body">
                            <form id="form-despesa">
                                <div class="form-group">
                                    <label for="categoria">Categoria</label>
                                    <select id="categoria" class="form-control" required>
                                        <option value="">Selecione...</option>
                                        <option value="materiais">Materiais</option>
                                        <option value="salarios">Salários</option>
                                        <option value="aluguel">Aluguel</option>
                                        <option value="utilidades">Utilidades</option>
                                        <option value="outros">Outros</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="descricao">Descrição</label>
                                    <input type="text" id="descricao" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="valor-despesa">Valor (R$)</label>
                                    <input type="number" id="valor-despesa" class="form-control" step="0.01" required>
                                </div>
                                <button type="submit" class="btn">Registrar Despesa</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal para edição -->
    <div id="modal-edicao" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-titulo">Editar Item</h3>
                <button class="modal-close" onclick="fecharModal()">&times;</button>
            </div>
            <div id="modal-conteudo">
                <!-- Conteúdo do modal será preenchido dinamicamente -->
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>AutoChapas &copy; 2023 - Todos os direitos reservados</p>
        </div>
    </footer>

    <script>
        // Dados da aplicação
        let orcamentos = JSON.parse(localStorage.getItem('orcamentos')) || [
            {
                id: 1,
                cliente: "João Silva",
                veiculo: "VW Gol",
                placa: "ABC1234",
                valor: 850.00,
                status: "pending",
                servico: "Martelinho de Ouro",
                data: "2023-10-15"
            },
            {
                id: 2,
                cliente: "Maria Santos",
                veiculo: "Fiat Uno",
                placa: "XYZ5678",
                valor: 1200.00,
                status: "pending",
                servico: "Funilaria Completa",
                data: "2023-10-14"
            }
        ];

        let carrosEntrada = JSON.parse(localStorage.getItem('carrosEntrada')) || [
            {
                id: 1,
                cliente: "Roberto Alves",
                veiculo: "Honda Civic",
                placa: "JKL7890",
                servico: "Reparo de Porta",
                data: "2023-10-18",
                valor: 750.00
            }
        ];

        let carrosOficina = JSON.parse(localStorage.getItem('carrosOficina')) || [
            {
                id: 1,
                cliente: "Carlos Oliveira",
                veiculo: "Chevrolet Onix",
                placa: "DEF9012",
                servico: "Pintura",
                status: "pending",
                previsao: "2023-10-25",
                valor: 850.00
            },
            {
                id: 2,
                cliente: "Ana Pereira",
                veiculo: "Toyota Corolla",
                placa: "GHI3456",
                servico: "Martelinho de Ouro",
                status: "in-progress",
                previsao: "2023-10-18",
                valor: 650.00
            }
        ];

        let servicosCompletos = JSON.parse(localStorage.getItem('servicosCompletos')) || [
            {
                id: 1,
                data: "15/10/2023",
                cliente: "João Silva",
                veiculo: "VW Gol",
                placa: "ABC1234",
                servico: "Martelinho de Ouro",
                valor: 850.00
            },
            {
                id: 2,
                data: "12/10/2023",
                cliente: "Mariana Souza",
                veiculo: "Hyundai HB20",
                placa: "STU9012",
                servico: "Pintura Completa",
                valor: 2500.00
            }
        ];

        let despesas = JSON.parse(localStorage.getItem('despesas')) || [
            { categoria: "Materiais", valor: 3250.00 },
            { categoria: "Salários", valor: 1980.00 },
            { categoria: "Aluguel", valor: 800.00 },
            { categoria: "Utilidades", valor: 200.00 }
        ];

        // Função para salvar dados no localStorage
        function salvarDados() {
            localStorage.setItem('orcamentos', JSON.stringify(orcamentos));
            localStorage.setItem('carrosEntrada', JSON.stringify(carrosEntrada));
            localStorage.setItem('carrosOficina', JSON.stringify(carrosOficina));
            localStorage.setItem('servicosCompletos', JSON.stringify(servicosCompletos));
            localStorage.setItem('despesas', JSON.stringify(despesas));
        }

        // Navegação entre páginas
        document.addEventListener('DOMContentLoaded', function() {
            const navLinks = document.querySelectorAll('.nav-link');
            const pages = document.querySelectorAll('.page');
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove a classe active de todos os links
                    navLinks.forEach(l => l.classList.remove('active'));
                    
                    // Adiciona a classe active ao link clicado
                    this.classList.add('active');
                    
                    // Oculta todas as páginas
                    pages.forEach(page => page.classList.remove('active'));
                    
                    // Mostra a página correspondente
                    const pageId = this.getAttribute('data-page');
                    document.getElementById(pageId).classList.add('active');
                });
            });
            
            // Formulário de despesa
            const formDespesa = document.getElementById('form-despesa');
            if (formDespesa) {
                formDespesa.addEventListener('submit', function(e) {
                    e.preventDefault();
                    registrarDespesa();
                });
            }

            // Inicializar dados
            atualizarTodasAsTabelas();
            atualizarContadores();
            atualizarFinanceiro();
        });

        // Aplica o comportamento em todos os selects de .descricao
        document.addEventListener('change', function (e) {
            if (e.target.classList.contains('descricao')) {
                const inputManual = e.target.parentElement.querySelector('.descricao-manual');
                if (e.target.value === 'outro') {
                    inputManual.style.display = 'block';
                } else {
                    inputManual.style.display = 'none';
                }
            }
        });

        function adicionarProduto() {
            const container = document.getElementById('produtos');
            const div = document.createElement('div');
            div.classList.add('produto');
            div.innerHTML = ` 
                <select class="descricao form-control">
                    <option value="">Selecione a peça ou serviço</option>
                    <optgroup label="Peças">
                        <option>Porta Dianteira Esquerda</option>
                        <option>Porta Dianteira Direita</option>
                        <option>Porta Traseira Esquerda</option>
                        <option>Porta Traseira Direita</option>
                        <option>Parachoque Dianteiro</option>
                        <option>Parachoque Traseiro</option>
                        <option>Capô</option>
                        <option>Farol Esquerdo</option>
                        <option>Farol Direito</option>
                        <option>Lanterna Esquerda</option>
                        <option>Lanterna Direita</option>
                        <option>Alma Dianteira</option>
                        <option>Painel Frontal</option>
                    </optgroup>
                    <optgroup label="Serviços de Mão de Obra">
                        <option>Mão de Obra - Funilaria</option>
                        <option>Mão de Obra - Pintura</option>
                        <option>Mão de Obra - Polimento</option>
                        <option>Mão de Obra - Desmontagem</option>
                        <option>Mão de Obra - Montagem</option>
                        <option>Mão de Obra - Alinhamento de Chassi</option>
                        <option>Mão de Obra - Substituição de Parachoque</option>
                        <option>Mão de Obra - Solda</option>
                        <option>Mão de Obra - Revisão</option>
                        <option>Mão de Obra - Lavagem Completa</option>
                    </optgroup>
                    <option value="outro">Outro serviço (digite manualmente)</option>
                </select>
                <input type="text" class="descricao-manual form-control" placeholder="Descreva o serviço" style="display:none; margin-top: 5px;" />
                <input placeholder="Quantidade" type="number" class="quantidade form-control" />
                <input placeholder="Valor Unitário" type="number" class="valor form-control" />
                <button class="btn btn-danger" onclick="removerProduto(this)">Remover</button>
            `;
            container.appendChild(div);
        }

        function removerProduto(button) {
            const produto = button.parentElement;
            produto.remove();
        }

        function salvarOrcamento() {
            const cliente = document.getElementById('cliente').value;
            const data = document.getElementById('data').value;
            const placa = document.getElementById('placa').value;
            const modelo = document.getElementById('modeloCarro').value;
            
            if (!cliente || !data || !placa || !modelo) {
                alert('Por favor, preencha todos os campos obrigatórios!');
                return;
            }

            // Calcular valor total
            let valorTotal = 0;
            const produtos = document.querySelectorAll('.produto');
            let servicoPrincipal = '';
            
            produtos.forEach((produto, index) => {
                const descricao = produto.querySelector('.descricao').value;
                const descricaoManual = produto.querySelector('.descricao-manual').value;
                const quantidade = parseFloat(produto.querySelector('.quantidade').value) || 0;
                const valor = parseFloat(produto.querySelector('.valor').value) || 0;
                
                if (index === 0) {
                    servicoPrincipal = descricaoManual || descricao;
                }
                
                valorTotal += quantidade * valor;
            });

            if (valorTotal === 0) {
                alert('Por favor, adicione pelo menos um produto/serviço com valor!');
                return;
            }

            // Criar novo orçamento
            const novoOrcamento = {
                id: orcamentos.length > 0 ? Math.max(...orcamentos.map(o => o.id)) + 1 : 1,
                cliente: cliente,
                veiculo: modelo,
                placa: placa,
                valor: valorTotal,
                status: "pending",
                servico: servicoPrincipal,
                data: data
            };

            orcamentos.push(novoOrcamento);
            salvarDados();
            
            // Limpar formulário
            document.getElementById('cliente').value = '';
            document.getElementById('data').value = '';
            document.getElementById('placa').value = '';
            document.getElementById('modeloCarro').value = '';
            document.getElementById('observacoes').value = '';
            document.getElementById('produtos').innerHTML = `
                <div class="produto">
                    <select class="descricao form-control">
                        <option value="">Selecione a peça ou serviço</option>
                        <optgroup label="Peças">
                            <option>Porta Dianteira Esquerda</option>
                            <option>Porta Dianteira Direita</option>
                            <option>Porta Traseira Esquerda</option>
                            <option>Porta Traseira Direita</option>
                            <option>Parachoque Dianteiro</option>
                            <option>Parachoque Traseiro</option>
                            <option>Capô</option>
                            <option>Farol Esquerdo</option>
                            <option>Farol Direito</option>
                            <option>Lanterna Esquerda</option>
                            <option>Lanterna Direita</option>
                            <option>Alma Dianteira</option>
                            <option>Painel Frontal</option>
                        </optgroup>
                        <optgroup label="Serviços de Mão de Obra">
                            <option>Mão de Obra - Funilaria</option>
                            <option>Mão de Obra - Pintura</option>
                            <option>Mão de Obra - Polimento</option>
                            <option>Mão de Obra - Desmontagem</option>
                            <option>Mão de Obra - Montagem</option>
                            <option>Mão de Obra - Alinhamento de Chassi</option>
                            <option>Mão de Obra - Substituição de Parachoque</option>
                            <option>Mão de Obra - Solda</option>
                            <option>Mão de Obra - Revisão</option>
                            <option>Mão de Obra - Lavagem Completa</option>
                        </optgroup>
                        <option value="outro">Outro serviço (digite manualmente)</option>
                    </select>
                    <input type="text" class="descricao-manual form-control" placeholder="Descreva o serviço" style="display:none; margin-top: 5px;" />
                    <input placeholder="Quantidade" type="number" class="quantidade form-control" />
                    <input placeholder="Valor Unitário" type="number" class="valor form-control" />
                    <button class="btn btn-danger" onclick="removerProduto(this)">Remover</button>
                </div>
            `;

            // Atualizar tabelas
            atualizarTabelaOrcamentos();
            atualizarContadores();
            
            alert('Orçamento salvo com sucesso!');
        }

        function aprovarOrcamento(button) {
            const row = button.closest('tr');
            const orcamentoId = parseInt(row.getAttribute('data-id'));
            
            // Encontrar o orçamento
            const orcamentoIndex = orcamentos.findIndex(o => o.id === orcamentoId);
            if (orcamentoIndex !== -1) {
                // Atualizar status do orçamento
                orcamentos[orcamentoIndex].status = "approved";
                
                // Adicionar à lista de carros para entrar
                const orcamento = orcamentos[orcamentoIndex];
                const hoje = new Date();
                const dataEntrada = new Date(hoje);
                dataEntrada.setDate(hoje.getDate() + 2); // Agendar para 2 dias a partir de hoje
                
                const novoCarroEntrada = {
                    id: carrosEntrada.length > 0 ? Math.max(...carrosEntrada.map(c => c.id)) + 1 : 1,
                    cliente: orcamento.cliente,
                    veiculo: orcamento.veiculo,
                    placa: orcamento.placa,
                    servico: orcamento.servico,
                    data: dataEntrada.toISOString().split('T')[0],
                    valor: orcamento.valor,
                    orcamentoId: orcamento.id
                };
                
                carrosEntrada.push(novoCarroEntrada);
                salvarDados();
                
                // Atualizar todas as tabelas
                atualizarTodasAsTabelas();
                atualizarContadores();
                
                alert('Orçamento aprovado! Carro adicionado à lista de entrada.');
            }
        }

        function recusarOrcamento(button) {
            const row = button.closest('tr');
            const orcamentoId = parseInt(row.getAttribute('data-id'));
            
            // Encontrar o orçamento
            const orcamentoIndex = orcamentos.findIndex(o => o.id === orcamentoId);
            if (orcamentoIndex !== -1) {
                // Atualizar status do orçamento
                orcamentos[orcamentoIndex].status = "rejected";
                salvarDados();
                
                // Atualizar tabelas
                atualizarTabelaOrcamentos();
                atualizarContadores();
                
                alert('Orçamento recusado!');
            }
        }

        function confirmarEntrada(button) {
            const row = button.closest('tr');
            const carroId = parseInt(row.getAttribute('data-id'));
            
            // Encontrar o carro
            const carroIndex = carrosEntrada.findIndex(c => c.id === carroId);
            if (carroIndex !== -1) {
                const carro = carrosEntrada[carroIndex];
                
                // Adicionar à lista de carros na oficina
                const novoCarroOficina = {
                    id: carrosOficina.length > 0 ? Math.max(...carrosOficina.map(c => c.id)) + 1 : 1,
                    cliente: carro.cliente,
                    veiculo: carro.veiculo,
                    placa: carro.placa,
                    servico: carro.servico,
                    status: "pending",
                    previsao: carro.data,
                    valor: carro.valor,
                    entradaId: carro.id
                };
                
                carrosOficina.push(novoCarroOficina);
                
                // Remover da lista de entrada
                carrosEntrada.splice(carroIndex, 1);
                salvarDados();
                
                // Atualizar todas as tabelas
                atualizarTodasAsTabelas();
                atualizarContadores();
                
                alert('Entrada confirmada! Carro movido para a oficina.');
            }
        }

        function cancelarEntrada(button) {
            const row = button.closest('tr');
            const carroId = parseInt(row.getAttribute('data-id'));
            
            // Encontrar o carro
            const carroIndex = carrosEntrada.findIndex(c => c.id === carroId);
            if (carroIndex !== -1) {
                // Remover da lista de entrada
                carrosEntrada.splice(carroIndex, 1);
                salvarDados();
                
                // Atualizar tabelas
                atualizarTabelaCarrosEntrada();
                atualizarContadores();
                
                alert('Entrada cancelada!');
            }
        }

        function atualizarStatusCarro(button, novoStatus) {
            const card = button.closest('.card');
            const carroId = parseInt(card.getAttribute('data-id'));
            
            // Encontrar o carro
            const carroIndex = carrosOficina.findIndex(c => c.id === carroId);
            if (carroIndex !== -1) {
                if (novoStatus === 'completed') {
                    // Mover para serviços completos
                    const carro = carrosOficina[carroIndex];
                    const hoje = new Date();
                    const dataFormatada = `${hoje.getDate().toString().padStart(2, '0')}/${(hoje.getMonth() + 1).toString().padStart(2, '0')}/${hoje.getFullYear()}`;
                    
                    const novoServicoCompleto = {
                        id: servicosCompletos.length > 0 ? Math.max(...servicosCompletos.map(s => s.id)) + 1 : 1,
                        data: dataFormatada,
                        cliente: carro.cliente,
                        veiculo: carro.veiculo,
                        placa: carro.placa,
                        servico: carro.servico,
                        valor: carro.valor,
                        carroId: carro.id
                    };
                    
                    servicosCompletos.push(novoServicoCompleto);
                    
                    // Remover da lista de carros na oficina
                    carrosOficina.splice(carroIndex, 1);
                    salvarDados();
                    
                    // Atualizar todas as tabelas
                    atualizarTodasAsTabelas();
                    atualizarContadores();
                    atualizarFinanceiro();
                    
                    alert('Carro movido para serviços completos!');
                } else {
                    // Apenas atualizar o status
                    carrosOficina[carroIndex].status = novoStatus;
                    salvarDados();
                    atualizarTabelaCarrosOficina();
                }
            }
        }

        // Funções para atualizar as tabelas
        function atualizarTodasAsTabelas() {
            atualizarTabelaOrcamentos();
            atualizarTabelaCarrosEntrada();
            atualizarTabelaCarrosOficina();
            atualizarTabelaServicosCompletos();
            atualizarTabelaAtividades();
            atualizarTabelaDespesas();
        }

        function atualizarTabelaOrcamentos() {
            const tbody = document.getElementById('orcamentos-pendentes');
            tbody.innerHTML = '';
            
            orcamentos.forEach(orcamento => {
                if (orcamento.status === 'pending') {
                    const row = document.createElement('tr');
                    row.setAttribute('data-id', orcamento.id);
                    row.innerHTML = `
                        <td>${orcamento.cliente}</td>
                        <td>${orcamento.veiculo}</td>
                        <td>${orcamento.placa}</td>
                        <td>R$ ${orcamento.valor.toFixed(2)}</td>
                        <td><span class="status-badge status-pending">Pendente</span></td>
                        <td>
                            <button class="btn btn-success" onclick="aprovarOrcamento(this)">Aprovar</button>
                            <button class="btn btn-danger" onclick="recusarOrcamento(this)">Recusar</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                }
            });
        }

        function atualizarTabelaCarrosEntrada() {
            const tbody = document.getElementById('carros-entrada-lista');
            tbody.innerHTML = '';
            
            carrosEntrada.forEach(carro => {
                const row = document.createElement('tr');
                row.setAttribute('data-id', carro.id);
                row.innerHTML = `
                    <td>${carro.cliente}</td>
                    <td>${carro.veiculo}</td>
                    <td>${carro.placa}</td>
                    <td>${carro.servico}</td>
                    <td><input type="date" value="${carro.data}" class="form-control" onchange="atualizarDataEntrada(${carro.id}, this.value)"></td>
                    <td>R$ <input type="number" value="${carro.valor}" class="form-control" style="width: auto; display: inline;" onchange="atualizarValorEntrada(${carro.id}, this.value)"></td>
                    <td>
                        <button class="btn" onclick="confirmarEntrada(this)">Confirmar Entrada</button>
                        <button class="btn btn-danger" onclick="cancelarEntrada(this)">Cancelar</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function atualizarTabelaCarrosOficina() {
            const container = document.getElementById('carros-oficina-grid');
            container.innerHTML = '';
            
            carrosOficina.forEach(carro => {
                const statusText = carro.status === 'pending' ? 'Aguardando' : 'Em Andamento';
                const statusClass = carro.status === 'pending' ? 'status-pending' : 'status-in-progress';
                const buttonText = carro.status === 'pending' ? 'Iniciar Serviço' : 'Marcar como Concluído';
                const buttonAction = carro.status === 'pending' ? 'in-progress' : 'completed';
                
                const card = document.createElement('div');
                card.classList.add('card');
                card.setAttribute('data-id', carro.id);
                card.innerHTML = `
                    <div class="card-header">${carro.veiculo} - ${carro.placa}</div>
                    <div class="card-body">
                        <p><strong>Cliente:</strong> ${carro.cliente}</p>
                        <p><strong>Serviço:</strong> ${carro.servico}</p>
                        <p><strong>Status:</strong> <span class="status-badge ${statusClass}">${statusText}</span></p>
                        <p><strong>Previsão:</strong> <input type="date" value="${carro.previsao}" class="form-control" style="width: auto; display: inline;" onchange="atualizarPrevisaoCarro(${carro.id}, this.value)"></p>
                        <p><strong>Valor:</strong> R$ <input type="number" value="${carro.valor}" class="form-control" style="width: auto; display: inline;" onchange="atualizarValorCarro(${carro.id}, this.value)"></p>
                        <button class="btn" onclick="atualizarStatusCarro(this, '${buttonAction}')">${buttonText}</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function atualizarTabelaServicosCompletos() {
            const tbody = document.getElementById('servicos-completos-lista');
            tbody.innerHTML = '';
            
            servicosCompletos.forEach(servico => {
                const row = document.createElement('tr');
                row.setAttribute('data-id', servico.id);
                row.innerHTML = `
                    <td>${servico.data}</td>
                    <td>${servico.cliente}</td>
                    <td>${servico.veiculo}</td>
                    <td>${servico.placa}</td>
                    <td>${servico.servico}</td>
                    <td>${servico.valor.toFixed(2)}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function atualizarTabelaAtividades() {
            const tbody = document.getElementById('atividades-recentes');
            tbody.innerHTML = '';
            
            // Combinar atividades recentes de diferentes fontes
            const atividades = [];
            
            // Adicionar orçamentos recentes
            orcamentos.slice(-3).forEach(orcamento => {
                atividades.push({
                    tipo: 'Orçamento',
                    descricao: `${orcamento.veiculo} - ${orcamento.placa}`,
                    detalhe: orcamento.servico,
                    status: orcamento.status,
                    data: orcamento.data
                });
            });
            
            // Adicionar carros na oficina recentes
            carrosOficina.slice(-3).forEach(carro => {
                atividades.push({
                    tipo: 'Oficina',
                    descricao: `${carro.veiculo} - ${carro.placa}`,
                    detalhe: carro.servico,
                    status: carro.status,
                    data: carro.previsao
                });
            });
            
            // Ordenar por data (mais recente primeiro) e pegar as 3 mais recentes
            atividades.sort((a, b) => new Date(b.data) - new Date(a.data));
            const atividadesRecentes = atividades.slice(0, 3);
            
            atividadesRecentes.forEach(atividade => {
                let statusBadge = '';
                if (atividade.status === 'pending') {
                    statusBadge = '<span class="status-badge status-pending">Pendente</span>';
                } else if (atividade.status === 'in-progress') {
                    statusBadge = '<span class="status-badge status-in-progress">Em Andamento</span>';
                } else if (atividade.status === 'approved') {
                    statusBadge = '<span class="status-badge status-approved">Aprovado</span>';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${atividade.descricao}</td>
                    <td>${atividade.detalhe}</td>
                    <td>${statusBadge}</td>
                    <td>${atividade.data}</td>
                    <td>
                        <button class="btn btn-warning" onclick="editarAtividade(this)">Editar</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function atualizarTabelaDespesas() {
            const tbody = document.getElementById('despesas-categoria');
            tbody.innerHTML = '';
            
            despesas.forEach((despesa, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${despesa.categoria}</td>
                    <td>${despesa.valor.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-warning" onclick="editarDespesa(${index})">Editar</button>
                        <button class="btn btn-danger" onclick="excluirDespesa(${index})">Excluir</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Funções auxiliares para atualizar dados
        function atualizarDataEntrada(id, novaData) {
            const carroIndex = carrosEntrada.findIndex(c => c.id === id);
            if (carroIndex !== -1) {
                carrosEntrada[carroIndex].data = novaData;
                salvarDados();
            }
        }

        function atualizarValorEntrada(id, novoValor) {
            const carroIndex = carrosEntrada.findIndex(c => c.id === id);
            if (carroIndex !== -1) {
                carrosEntrada[carroIndex].valor = parseFloat(novoValor);
                salvarDados();
            }
        }

        function atualizarPrevisaoCarro(id, novaPrevisao) {
            const carroIndex = carrosOficina.findIndex(c => c.id === id);
            if (carroIndex !== -1) {
                carrosOficina[carroIndex].previsao = novaPrevisao;
                salvarDados();
            }
        }

        function atualizarValorCarro(id, novoValor) {
            const carroIndex = carrosOficina.findIndex(c => c.id === id);
            if (carroIndex !== -1) {
                carrosOficina[carroIndex].valor = parseFloat(novoValor);
                salvarDados();
                atualizarFinanceiro();
                atualizarContadores();
            }
        }

        function calcularLucroMensal() {
            const receita = servicosCompletos.reduce((total, servico) => total + servico.valor, 0);
            const despesasTotal = despesas.reduce((total, despesa) => total + despesa.valor, 0);
            return receita - despesasTotal;
        }

        function atualizarContadores() {
            // Atualizar contador de carros na oficina
            document.getElementById('count-carros-oficina').textContent = carrosOficina.length;
            
            // Atualizar contador de orçamentos pendentes
            const orcamentosPendentes = orcamentos.filter(o => o.status === 'pending').length;
            document.getElementById('count-orcamentos-pendentes').textContent = orcamentosPendentes;
            
            // Atualizar contador de carros para entrar
            document.getElementById('count-carros-entrada').textContent = carrosEntrada.length;
            
            // Atualizar lucro do mês
            const lucroMensal = calcularLucroMensal();
            const lucroElement = document.getElementById('lucro-mes');
            lucroElement.textContent = `R$ ${lucroMensal.toFixed(2)}`;
            
            // Destacar mudanças
            lucroElement.classList.add('highlight');
            setTimeout(() => {
                lucroElement.classList.remove('highlight');
            }, 2000);
        }

        function atualizarFinanceiro() {
            const receitaTotal = servicosCompletos.reduce((total, servico) => total + servico.valor, 0);
            const despesasTotal = despesas.reduce((total, despesa) => total + despesa.valor, 0);
            const lucroMensal = receitaTotal - despesasTotal;
            
            // Atualizar elementos com animação
            const elementos = [
                { id: 'lucro-mes-financeiro', valor: lucroMensal },
                { id: 'receita-mes', valor: receitaTotal },
                { id: 'despesas-mes', valor: despesasTotal },
                { id: 'receita-anual', valor: receitaTotal * 12 }
            ];
            
            elementos.forEach(item => {
                const elemento = document.getElementById(item.id);
                elemento.textContent = `R$ ${item.valor.toFixed(2)}`;
                elemento.classList.add('highlight');
                setTimeout(() => {
                    elemento.classList.remove('highlight');
                }, 2000);
            });
        }

        function registrarDespesa() {
            const categoria = document.getElementById('categoria').value;
            const descricao = document.getElementById('descricao').value;
            const valor = parseFloat(document.getElementById('valor-despesa').value);
            
            if (categoria && descricao && valor) {
                despesas.push({
                    categoria: categoria,
                    descricao: descricao,
                    valor: valor
                });
                salvarDados();
                
                // Atualizar tabela de despesas
                atualizarTabelaDespesas();
                
                // Atualizar estatísticas financeiras
                atualizarFinanceiro();
                atualizarContadores();
                
                // Limpar formulário
                document.getElementById('form-despesa').reset();
                
                alert('Despesa registrada com sucesso!');
            } else {
                alert('Por favor, preencha todos os campos!');
            }
        }

        function editarDespesa(index) {
            const despesa = despesas[index];
            abrirModal('Editar Despesa', `
                <div class="form-group">
                    <label for="edit-despesa-categoria">Categoria:</label>
                    <input type="text" id="edit-despesa-categoria" class="form-control" value="${despesa.categoria}">
                </div>
                <div class="form-group">
                    <label for="edit-despesa-descricao">Descrição:</label>
                    <input type="text" id="edit-despesa-descricao" class="form-control" value="${despesa.descricao || ''}">
                </div>
                <div class="form-group">
                    <label for="edit-despesa-valor">Valor:</label>
                    <input type="number" id="edit-despesa-valor" class="form-control" value="${despesa.valor}">
                </div>
                <button class="btn btn-success" onclick="salvarEdicaoDespesa(${index})">Salvar</button>
            `);
        }

        function salvarEdicaoDespesa(index) {
            const categoria = document.getElementById('edit-despesa-categoria').value;
            const descricao = document.getElementById('edit-despesa-descricao').value;
            const valor = parseFloat(document.getElementById('edit-despesa-valor').value);
            
            if (categoria && valor) {
                despesas[index] = {
                    categoria: categoria,
                    descricao: descricao,
                    valor: valor
                };
                salvarDados();
                
                // Atualizar tabelas
                atualizarTabelaDespesas();
                atualizarFinanceiro();
                atualizarContadores();
                
                fecharModal();
                alert('Despesa atualizada com sucesso!');
            } else {
                alert('Por favor, preencha todos os campos obrigatórios!');
            }
        }

        function excluirDespesa(index) {
            if (confirm('Tem certeza que deseja excluir esta despesa?')) {
                despesas.splice(index, 1);
                salvarDados();
                
                // Atualizar tabelas
                atualizarTabelaDespesas();
                atualizarFinanceiro();
                atualizarContadores();
                
                alert('Despesa excluída com sucesso!');
            }
        }

        function abrirModal(titulo, conteudo) {
            document.getElementById('modal-titulo').textContent = titulo;
            document.getElementById('modal-conteudo').innerHTML = conteudo;
            document.getElementById('modal-edicao').style.display = 'flex';
        }

        function fecharModal() {
            document.getElementById('modal-edicao').style.display = 'none';
        }

        // Fechar modal ao clicar fora dele
        window.onclick = function(event) {
            const modal = document.getElementById('modal-edicao');
            if (event.target === modal) {
                fecharModal();
            }
        }

        async function gerarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const cliente = document.getElementById('cliente').value;
            const data = document.getElementById('data').value;
            const placa = document.getElementById('placa').value;
            const modelo = document.getElementById('modeloCarro').value;

            const descricoes = document.querySelectorAll('.descricao');
            const quantidades = document.querySelectorAll('.quantidade');
            const valores = document.querySelectorAll('.valor');
            const descricaoManuais = document.querySelectorAll('.descricao-manual');

            let totalGeral = 0;
            const rows = [];

            for (let i = 0; i < descricoes.length; i++) {
                const desc = descricoes[i].value;
                const manualDesc = descricaoManuais[i].value;
                const qtd = parseInt(quantidades[i].value) || 0;
                const valor = parseFloat(valores[i].value) || 0;
                const total = qtd * valor;

                const descricaoFinal = manualDesc ? manualDesc : desc;

                totalGeral += total;

                if (descricaoFinal) {
                    rows.push([descricaoFinal, qtd, `R$ ${valor.toFixed(2)}`, `R$ ${total.toFixed(2)}`]);
                }
            }

            doc.setFontSize(14);
            doc.text('ALEXANDRE REPAROS AUTOMOTIVOS', 105, 15, { align: 'center' });

            doc.setFontSize(11);
            doc.text('CNPJ: 52219997000179', 14, 25);
            doc.text('TELEFONE: (51) 999045187', 14, 32);
            doc.text('ENDEREÇO: Rua Waldemar Boa Vista, 96 - Cohab', 14, 39);

            doc.text(`NOME DO CLIENTE: ${cliente}`, 14, 50);
            doc.text(`DATA: ${data}`, 14, 57);
            doc.text(`NÚMERO DA PLACA: ${placa}`, 14, 64);
            doc.text(`MODELO DO CARRO: ${modelo}`, 14, 71);

            doc.autoTable({
                startY: 80,
                head: [['PRODUTO/DESCRIÇÃO', 'QUANTIDADE', 'VALOR', 'TOTAL']],
                body: rows,
                styles: { halign: 'center' },
                headStyles: { fillColor: [0, 0, 0] },
                theme: 'grid',
            });

            let finalY = doc.lastAutoTable.finalY + 10;
            doc.setFontSize(12);
            doc.text(`TOTAL GERAL: R$ ${totalGeral.toFixed(2)}`, 14, finalY);

            const observacoes = document.getElementById('observacoes').value;
            if (observacoes) {
                const obsY = finalY + 10;
                doc.setFontSize(11);
                doc.text("OBSERVAÇÕES:", 14, obsY);

                doc.setDrawColor(0);
                doc.setFillColor(255, 255, 255); 
                doc.rect(14, obsY + 6, 180, 50); 

                doc.setFontSize(10);
                const splitText = doc.splitTextToSize(observacoes, 180); 
                doc.text(splitText, 14, obsY + 12); 
            }

            doc.save('Orcamento.pdf');
        }
    </script>
</body>
</html>